# BiliMusicPlayer 播放功能说明

## ✅ 已修复的问题

### 1. 进度条实时更新
- **问题**: 播放时进度条不动
- **解决**: 每100ms更新一次播放位置，确保进度条流畅移动
- **测试**: 播放任意歌曲，观察进度条是否平滑移动

### 2. 自动播放下一曲
- **问题**: 点击下一曲按钮后无法切换到下一首歌曲
- **解决**: 采用两阶段加载策略
  - 第一阶段：快速加载前5首歌曲并开始播放
  - 第二阶段：后台加载收藏夹剩余所有歌曲
- **测试**:
  1. 在收藏夹中点击任意歌曲播放
  2. 连续点击"下一曲"按钮
  3. 应该能够顺畅切换到后续歌曲

### 3. 通知栏播放列表显示
- **问题**: 通知栏播放到第三首后没有显示播放列表
- **解决**: 完整加载收藏夹所有歌曲到播放队列
- **测试**:
  1. 播放收藏夹歌曲
  2. 下拉通知栏查看播放控制
  3. 应该能看到完整的播放队列信息

## 🎵 播放功能详解

### 播放收藏夹歌曲
1. 进入"收藏夹"页面
2. 选择一个收藏夹
3. 点击任意歌曲的播放按钮▶️
4. 系统会：
   - 立即加载并播放点击的歌曲
   - 同时加载接下来4首歌曲（总共5首）
   - 跳转到播放器页面
   - 在后台继续加载收藏夹剩余歌曲

### 播放控制
- **播放/暂停**: 点击播放器或迷你播放器的播放按钮
- **上一曲**: 点击⏮️按钮
- **下一曲**: 点击⏭️按钮
- **进度控制**: 拖动进度条到任意位置
- **随机播放**: 点击🔀按钮开启/关闭
- **循环模式**: 点击🔁按钮切换
  - 关闭循环（默认）
  - 列表循环
  - 单曲循环

### 迷你播放器
- 在除登录页和播放器页外的所有页面底部显示
- 显示当前播放的歌曲信息
- 提供快速播放控制
- 点击可展开到完整播放器

### 播放队列
- 在播放器页面点击顶部的🎵图标
- 查看当前播放队列
- 显示正在播放的歌曲
- 可以切换随机播放模式

## 🔧 技术实现

### 两阶段加载策略
```
用户点击播放
    ↓
加载前5首歌曲 (同步)
    ↓
开始播放 + 跳转播放器
    ↓
后台加载剩余歌曲 (异步)
    ↓
完整播放列表就绪
```

### 优势
- **快速启动**: 用户点击后1-2秒即可开始播放
- **完整队列**: 最终会加载收藏夹所有歌曲
- **不阻塞UI**: 后台加载不影响用户操作
- **容错性**: 某首歌曲加载失败会自动跳过

### 进度更新机制
- 使用 `LaunchedEffect` 协程
- 每100毫秒更新一次位置
- 确保进度条平滑流畅
- 拖动时立即响应

## 📱 使用建议

### 最佳体验
1. **网络环境**: 建议在WiFi环境下使用，避免消耗大量移动数据
2. **收藏夹大小**: 收藏夹歌曲越多，后台加载时间越长
3. **播放质量**: 当前使用64音质（纯音频），加载速度快

### 注意事项
1. 点击播放后请稍等1-2秒，等待歌曲加载
2. 如果某首歌曲无法播放，会自动跳过
3. 后台加载时可以正常使用其他功能
4. 建议收藏夹不要超过100首，否则加载时间较长

## 🐛 已知问题

1. **加载进度**: 后台加载时没有显示具体进度
2. **网络超时**: 网络不稳定时部分歌曲可能加载失败
3. **队列编辑**: 暂不支持手动调整播放顺序

## 🎯 测试步骤

### 完整测试流程
1. **登录测试**
   - 扫码登录B站账号
   - 确认登录成功

2. **收藏夹测试**
   - 进入收藏夹页面
   - 查看收藏夹列表
   - 选择一个有多首歌曲的收藏夹

3. **播放测试**
   - 点击第一首歌曲播放
   - 等待1-2秒，确认播放开始
   - 观察进度条是否移动

4. **切歌测试**
   - 点击"下一曲"按钮多次
   - 确认能够顺畅切换
   - 至少测试切换5首以上

5. **通知栏测试**
   - 下拉通知栏
   - 查看播放控制
   - 在通知栏点击"下一曲"
   - 确认能够正常切换

6. **迷你播放器测试**
   - 返回其他页面（首页、收藏夹等）
   - 观察底部迷你播放器
   - 点击迷你播放器
   - 确认跳转到完整播放器

7. **播放队列测试**
   - 在播放器页面点击队列图标
   - 查看播放队列
   - 切换随机播放模式

## 📞 反馈

如果遇到问题，请记录：
1. 操作步骤
2. 预期结果
3. 实际结果
4. 错误信息（如果有）
5. 设备型号和Android版本
